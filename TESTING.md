# 测试指南

本文档说明如何通过 H5 和小程序平台对 OrderEase 项目进行全面测试。

---

## 概述

OrderEase-FrontUI 使用 uni-app 构建，支持 H5 和微信小程序双平台部署。通过合理的测试策略，可以高效地验证大部分功能。

---

## H5 与小程序测试能力对比

### 可以通过 H5 验证的功能

| 功能类别 | 验证程度 | 说明 |
|---------|---------|------|
| 业务逻辑 | 100% | API 调用、数据处理、状态管理等代码完全相同 |
| 基础 UI | 95% | uni-app 原生组件在两平台表现基本一致 |
| 路由跳转 | 100% | `uni.navigateTo`、`uni.switchTab` 等逻辑一致 |
| 组件交互 | 100% | Props 传递、事件触发、父子组件通信 |
| 表单处理 | 100% | 输入验证、提交逻辑 |
| 购物车逻辑 | 100% | 商品选择、规格选项、数量管理 |

### 无法通过 H5 验证的功能（小程序特有）

| 功能 | 影响 |
|------|------|
| 微信登录 | `uni.login` 在 H5 会降级到其他方式或直接失败 |
| 微信支付 | 小程序支付 API 在 H5 不存在 |
| 分享到微信 | `uni.share` 仅小程序支持 |
| 获取用户信息 | 授权弹窗、头像昵称等 |
| 小程序码生成 | `uni.getQRCode` 等接口 |
| 订阅消息 | 消息订阅和模板通知 |
| 手机号快速验证 | `getPhoneNumber` 事件 |

### 可能存在差异的功能

| 方面 | 说明 |
|------|------|
| 样式细节 | 某些 CSS 属性在小程序和 H5 渲染略有略有不同 |
| 滚动性能 | 小程序有更严格的性能限制 |
| 文件权限 | 小程序对本地文件访问更严格 |
| 网络请求 | 小程序需要配置白名单域名 |

---

## 测试流程

### 阶段 1: H5 测试（核心业务功能）

```bash
# 启动 H5 开发服务器
npm run dev
```

访问 `http://localhost:3002` 进行测试。

**测试清单：**

- [ ] 用户注册流程
  - [ ] 表单验证
  - [ ] 注册成功跳转
  - [ ] 错误提示显示

- [ ] 用户登录流程
  - [ ] 账号密码登录
  - [ ] Token 登录（如果有）
  - [ ] 登录状态保持（刷新页面后仍有效）
  - [ ] 登录失败处理

- [ ] 商品浏览
  - [ ] 分类切换
  - [ ] 商品列表展示
  - [ ] 商品图片加载
  - [ ] 价格、名称等信息显示

- [ ] 商品规格选择
  - [ ] 打开规格弹窗
  - [ ] 规格选项选择（单选/多选）
  - [ ] 价格动态更新
  - [ ] 规格必选验证

- [ ] 购物车功能
  - [ ] 添加商品到购物车
  - [ ] 购物车数量更新
  - [ ] 购物车删除商品
  - [ ] 购物车总金额计算
  - [ ] 购物车弹窗打开/关闭

- [ ] 订单提交流程
  - [ ] 提交订单
  - [ ] 订单信息确认
  - [ ] 提交成功跳转
  - [ ] 提交失败处理

- [ ] 订单列表
  - [ ] 订单列表展示
  - [ ] 分页加载
  - [ ] 订单状态筛选（如果有）

- [ ] 订单详情
  - [ ] 订单详情查看
  - [ ] 订单状态显示

- [ ] 个人中心
  - [ ] 用户信息展示
  - [ ] 退出登录

**本项目兼容性说明：**

- 统一存储层 (`src/store/index.js`) 已确保 H5 与小程序存储行为一致
- 统一导航 (uni-app API) 确保跳转逻辑一致
- 图片处理逻辑已统一

---

### 阶段 2: 微信小程序测试（小程序特有功能）

```bash
# 编译小程序
npm run dev:mp-weixin
```

使用微信开发者工具打开 `dist/dev/mp-weixin` 目录。

**测试清单：**

- [ ] 微信登录授权
  - [ ] 授权弹窗正常弹出
  - [ ] 授权成功后用户信息获取
  - [ ] 授权拒绝处理

- [ ] 样式细节检查
  - [ ] 页面布局是否正常
  - [ ] 字体大小、间距是否合理
  - [ ] 按钮样式是否一致
  - [ ] 弹窗/弹层位置和动画

- [ ] 性能测试
  - [ ] 页面加载速度
  - [ ] 列表滚动流畅度
  - [ ] 图片懒加载效果

- [ ] 平台 API 调用
  - [ ] `uni.chooseImage` 等原生 API（如果有用到）
  - [ ] 条件编译代码是否正确执行

---

### 阶段 3: 真机测试（关键功能）

**测试清单（如适用）：**

- [ ] 微信支付集成
  - [ ] 支付唤起
  - [ ] 支付成功回调
  - [ ] 支付取消处理

- [ ] 分享功能
  - [ ] 分享到好友
  - [ ] 分享到朋友圈（如果支持）

- [ ] 订阅消息
  - [ ] 消息订阅授权
  - [ ] 消息接收测试

- [ ] 手机号快速验证
  - [ ] 手机号获取授权
  - [ ] 手机号数据正确性

---

## 开发命令速查

```bash
# H5 开发
npm run dev               # http://localhost:3002

# H5 生产构建
npm run build             # 输出到 dist/h5
npm run preview           # 预览生产构建

# 小程序开发
npm run dev:mp-weixin     # 输出到 dist/dev/mp-weixin

# 小程序生产构建
npm run build:mp-weixin   # 输出到 dist/build/mp-weixin
```

---

## 测试覆盖率估算

对于 OrderEase 项目：

- **核心功能**: 80-90% 可通过 H5 验证
- **小程序特有功能**: 需要在微信开发者工具或真机上测试

---

## 常见问题

### Q: H5 测试通过后，小程序还需要测试哪些地方？

A: 重点关注样式渲染、微信授权相关 API、以及任何使用了条件编译的代码块。

### Q: 如何区分平台特定代码？

A: 使用 uni-app 条件编译：

```javascript
// #ifdef H5
// H5 特定代码
// #endif

// #ifdef MP-WEIXIN
// 小程序特定代码
// #endif
```

### Q: 如何在 H5 测试时调试 API 问题？

A: 使用浏览器开发者工具 (F12) 查看 Network 面板，确认请求参数和响应数据。

---

## 总结

通过分层测试策略：

1. **H5 测试** → 验证所有业务逻辑和基础交互（发现 80-90% 的问题）
2. **微信开发者工具测试** → 验证样式和小程序 API 调用
3. **真机测试** → 验证支付、授权、性能等核心功能

这样可以最大化测试效率，大部分问题能在 H5 阶段快速发现和修复。
