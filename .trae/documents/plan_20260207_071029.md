# 高优先级代码改造实施计划（已更新）

## 一、改造目标

完成以下高优先级任务，提升小程序完成度从 75% 到 90%+：

1. **实现 Pinia 状态管理**（购物车、用户、订单状态）
2. **实现分享功能**（分享给好友，个人小程序限制）
3. **更新文档**：标记 TokenLogin 为不需要（已有微信授权登录）

---

## 二、详细实施步骤

### 任务 1：实现 Pinia 状态管理（预计 2-3 天）

#### 1.1 创建 stores 目录结构
```
stores/
├── index.js          # Pinia 配置入口
├── cart.js          # 购物车状态管理
├── user.js          # 用户状态管理
└── order.js         # 订单状态管理
```

#### 1.2 创建 stores/index.js
- 配置 Pinia 实例
- 导出所有 stores

#### 1.3 创建 stores/cart.js
- 购物车列表状态
- 添加/删除/更新商品方法
- 计算总价和总数量
- 本地存储持久化

#### 1.4 创建 stores/user.js
- 用户信息状态
- 登录/登出方法
- Token 管理
- 本地存储持久化

#### 1.5 创建 stores/order.js
- 订单列表状态
- 订单详情状态
- 订单状态管理

#### 1.6 修改 main.js
- 引入 Pinia
- 挂载到 Vue 实例

#### 1.7 迁移现有页面使用 Pinia
- pages/home/index.vue：使用 cartStore
- pages/login/index.vue：使用 userStore
- pages/orders/index.vue：使用 orderStore

---

### 任务 2：实现分享功能（预计 1 天）

#### 2.1 在主要页面添加分享配置
- pages/home/index.vue：首页分享
- pages/order-detail/index.vue：订单详情分享

#### 2.2 准备分享资源
- 创建 static/share-image.png（分享给好友的图片）
- 建议尺寸：1200×960 像素

#### 2.3 实现分享逻辑
```javascript
// 分享给好友（个人小程序支持）
export default {
  onShareAppMessage() {
    return {
      title: '快来点餐吧',
      path: '/pages/home/index',
      imageUrl: '/static/share-image.png'
    }
  }
}
```

#### 2.4 测试分享功能
- 在微信开发者工具中测试
- 验证分享标题、图片、路径

---

### 任务 3：更新文档（预计 0.5 天）

#### 3.1 更新《小程序改造方案.md》
- 在 P0.5 节标记 TokenLogin 为"不需要"
- 添加说明：已有微信授权登录，无需令牌登录
- 更新完成度评估

---

## 三、文件清单

### 新增文件
- `stores/index.js` - Pinia 配置
- `stores/cart.js` - 购物车 store
- `stores/user.js` - 用户 store
- `stores/order.js` - 订单 store
- `static/share-image.png` - 分享图片

### 修改文件
- `main.js` - 配置 Pinia
- `pages/home/index.vue` - 使用 cartStore，添加分享
- `pages/login/index.vue` - 使用 userStore
- `pages/orders/index.vue` - 使用 orderStore
- `pages/order-detail/index.vue` - 添加分享
- `小程序改造方案.md` - 更新文档说明

---

## 四、预计工作量

| 任务 | 预计时间 | 难度 |
|-----|----------|------|
| Pinia 状态管理 | 2-3 天 | ⭐⭐⭐ |
| 分享功能 | 1 天 | ⭐⭐ |
| 更新文档 | 0.5 天 | ⭐ |
| **总计** | **3.5-4.5 天** | - |

---

## 五、验收标准

### Pinia 状态管理
- ✅ stores 目录创建完成
- ✅ 所有 store 正常工作
- ✅ 状态可跨页面共享
- ✅ 本地存储持久化正常

### 分享功能
- ✅ 分享按钮可正常触发
- ✅ 分享内容显示正确
- ✅ 分享路径跳转正确

### 文档更新
- ✅ TokenLogin 标记为"不需要"
- ✅ 添加微信授权登录说明

---

## 六、注意事项

1. **Pinia 兼容性**：确保与 Vue 3.4.29 兼容
2. **状态持久化**：使用 uni.storage 进行本地存储
3. **分享限制**：个人小程序不支持分享到朋友圈
4. **向后兼容**：确保不影响现有功能

---

**是否开始执行此计划？**